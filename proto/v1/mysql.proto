syntax = 'proto3';

package ultra.container.v1.mysql;

import "container/proto/v1/structures.proto";

service MysqlService {
    rpc listDb (ListDbRequest) returns (ListDbResponse) {
    }
    rpc createDb (CreateDbRequest) returns (CreateDbResponse) {
    }
    rpc deleteDb (DeleteDbRequest) returns (DeleteDbResponse) {
    }
    rpc commentDb (CommentDbRequest) returns (CommentDbResponse) {
    }
    rpc createUser (CreateUserRequest) returns (CreateUserResponse) {
    }
    rpc deleteUser (DeleteUserRequest) returns (DeleteUserResponse) {
    }
    rpc changePassword (ChangePasswordRequest) returns (ChangePasswordResponse) {
    }
    rpc addAccess (AddAccessRequest) returns (AddAccessResponse) {
    }
    rpc deleteAccess (DeleteAccessRequest) returns (DeleteAccessResponse) {
    }
}
message ListDbRequest {
    uint64 app_id = 1;
}

message ListDbResponse {
    repeated structures.Database db = 1;
}

message CreateDbRequest {
    uint64 name = 1;
    uint64 app_id = 2;
}

message CreateDbResponse {
    oneof result {
        structures.Database database = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            VALIDATION_ERROR = 1;
            NOT_FOUND_ERROR = 2;
        }
    }
}

message DeleteDbRequest {
    uint64 db_id = 1;
}

message DeleteDbResponse {
    oneof result {
        uint64 db_id = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_FOUND_ERROR = 1;
        }
    }
}

message CommentDbRequest {
    uint64 db_id = 1;
    string comment = 2;
}

message CommentDbResponse {
    oneof result {
        structures.Database database = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            VALIDATION_ERROR = 1;
            NOT_FOUND_ERROR = 2;
        }
    }
}

message CreateUserRequest {
    uint64 name = 1;
    uint64 host = 2;
    string password = 3;
    uint64 db_id = 4;
}

message CreateUserResponse {
    oneof result {
        structures.User user = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_FOUND_ERROR = 1;
        }
    }
}

message DeleteUserRequest {
    uint64 user_id = 1;
}

message DeleteUserResponse {
    oneof result {
        structures.User user = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_FOUND_ERROR = 1;
        }
    }
}

message ChangePasswordRequest {
    uint64 user_id = 1;
    string new_password = 2;
}

message ChangePasswordResponse {
    oneof result {
        structures.User user = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_FOUND_ERROR = 1;
        }
    }
}

message AddAccessRequest {
    uint64 db_id = 1;
    uint64 user_id = 2;
}

message AddAccessResponse {
    oneof result {
        structures.Database database = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_FOUND_ERROR = 1;
        }
    }
}

message DeleteAccessRequest {
    uint64 db_id = 1;
    uint64 user_id = 2;
}

message DeleteAccessResponse {
    oneof result {
        structures.Database database = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_FOUND_ERROR = 1;
        }
    }
}